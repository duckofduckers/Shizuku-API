import os
import sys

def main():
    base_path = "/storage/emulated/0/Android/data/org.qpython.qpy/files/lib/python3.12/site-packages"
    package_path = os.path.join(base_path, "shizuku_api")
    
    os.makedirs(package_path, exist_ok=True)
    
    init_code = """from .loader import load_shizuku_api

shizuku_api = load_shizuku_api()
run = shizuku_api.run
"""
    with open(os.path.join(package_path, "__init__.py"), "w") as f:
        f.write(init_code)
    
    loader_code = """import urllib.request as u
import ssl
import types
import sys

def load_shizuku_api():
    url = "https://raw.githubusercontent.com/duckofduckers/Shizuku-API/refs/heads/main/Shizuku%20API%20-%20Source"
    code = u.urlopen(url, context=ssl._create_unverified_context()).read().decode()
    
    module = types.ModuleType("shizuku_api")
    exec(code, module.__dict__)
    module.run = module._run
    sys.modules["shizuku_api"] = module
    return module
"""
    with open(os.path.join(package_path, "loader.py"), "w") as f:
        f.write(loader_code)
    
    print(f"shizuku_api installed successfully in {package_path}")

if __name__ == "__main__":
    main()
